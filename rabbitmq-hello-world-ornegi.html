<!DOCTYPE html>
<html class='no-js' lang='en'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<title>lab2023 | RabbitMQ 1 - RabbitMQ ile Merhaba Dünya Örneği
</title>
<meta content='Designers and developers for hire' name='description'>
<meta content='design, ruby on rails, ios, android, sencha, istanbul, ankara, denizli' name='keywords'>
<link href="assets/stylesheets/application.css" media="screen" rel="stylesheet" type="text/css" />
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" media="screen" rel="stylesheet" type="text/css" />
<link href="assets/images/favicon.png" rel="icon" type="image/png" />
<meta content='RabbitMQ 1 - RabbitMQ ile Merhaba Dünya Örneği' name='description'>
<meta content='rabbitmq, amqp, bunny, ruby, tr' name='keywords'>
<meta content='Onur Özgür ÖZKAN' name='author'>


</head>
<body id='blog'>
<header class='header'>
<div class='container'>
<div class='row'>
<div class='col-lg-2 col-lg-offset-1'>
<a href="/blog"><img class="logo pull-right" alt="" width="252" height="253" src="assets/images/logo.png" />
</a>
</div>
<div class='col-lg-8'>
<h1>
<a href="/blog">lab2023's blog posts</a>
<a target="_blank" href="http://lab2023.com/feed.xml"><i class='fa fa-rss'></i>
</a>
</h1>
<p>
<a href="/"><i class='fa fa-arrow-circle-left'></i>
lab2023.com
</a>
</p>
</div>
</div>
</div>
</header>

<!-- share-buttons js code -->
<div id='fb-root'>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/tr_TR/all.js#xfbml=1";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
  (function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs'));
</script>
</div>
<div class='container'>
<div class='row'>
<div class='col-lg-2 col-lg-offset-1 article-meta'>
<h4><a target="_blank" href="http://twitter.com/onurozgurozkan">Onur Özgür ÖZKAN</a></h4>
<h5>April 21, 2014</h5>
<span class='tag'><a href="/tag/rabbitmq.html">rabbitmq</a></span>
<span class='tag'><a href="/tag/amqp.html"> amqp</a></span>
<span class='tag'><a href="/tag/bunny.html"> bunny</a></span>
<span class='tag'><a href="/tag/ruby.html"> ruby</a></span>
<span class='tag'><a href="/tag/tr.html"> tr</a></span>
<!-- Share buttons -->
<ul class='share_button'>
<li>
<div class='fb-share-button' data-href='http://lab2023.com/rabbitmq-hello-world-ornegi.html' data-type='button_count'></div>
</li>
<li>
<a class='twitter-share-button' data-text='http://lab2023.com/rabbitmq-hello-world-ornegi.html' data-via='lab2023' href='https://twitter.com/share'></a>
</li>
<li>
<script src='//platform.linkedin.com/in.js' type='text/javascript'>
<![CDATA[
    lang: en_US
]]>
</script>
<script data-url='http://lab2023.com/rabbitmq-hello-world-ornegi.html' type='IN/Share'></script>
</li>
</ul>
</div>
<div class='col-lg-8'>
<article class='post'>
<h1>RabbitMQ 1 - RabbitMQ ile Merhaba Dünya Örneği</h1>
<p>Bir önceki makalemizde aşağıdaki konulardan bahsettik;</p>

<ul>
<li>RabbitMQ nedir?</li>
<li>Özellikleri nedir?</li>
<li>Kimler kullanmalıdır?</li>
<li>Kurulumu nasıl yapılmalıdır?</li>
</ul>

<p>Şimdi basit bir &lsquo;Merhaba Dünya&rsquo; uygulaması ile RabbitMQ&#39;da ilk mesajımızı gönderecek ve alacağız. Aşağıdaki grafik yapılacak işlemi gösterecektir.</p>

<p><img alt="Örnek 1" width="392" height="59" src="assets/images/articles/2013-04-20-rabbitmq-1.png" /></p>

<p><strong>Mesajın gönderilmesi</strong></p>

<ul>
<li>RabbitMQ&#39;ya bağlanmak için</li>
</ul>
<pre class="highlight ruby"><span class="c1">#!/usr/bin/env ruby</span>
<span class="c1"># encoding: utf-8</span>

<span class="nb">require</span> <span class="s2">"bunny"</span>

<span class="n">conn</span> <span class="o">=</span> <span class="no">Bunny</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:automatically_recover</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>
<span class="n">conn</span><span class="p">.</span><span class="nf">start</span>
</pre>

<ul>
<li>Yeni bir kanal yaratmak için</li>
</ul>
<pre class="highlight ruby"><span class="n">ch</span>   <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">create_channel</span>
</pre>

<ul>
<li>Yaratılan kanaldan bir queue isimlendirip mesaj göndermek için</li>
</ul>
<pre class="highlight ruby"><span class="n">q</span>    <span class="o">=</span> <span class="n">ch</span><span class="p">.</span><span class="nf">queue</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>
<span class="n">ch</span><span class="p">.</span><span class="nf">default_exchange</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="s2">"Hello World!"</span><span class="p">,</span> <span class="ss">:routing_key</span> <span class="o">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="nf">name</span><span class="p">)</span>
<span class="nb">puts</span> <span class="s2">" [x] Sent 'Hello World!'"</span>
</pre>

<ul>
<li>Bağlantıyı kapatmak için</li>
</ul>
<pre class="highlight ruby"><span class="n">conn</span><span class="p">.</span><span class="nf">close</span>
</pre>

<ul>
<li>Hepsini birleştirip <code>sender.rb</code> dosyasını oluşturalım.</li>
</ul>
<pre class="highlight ruby"><span class="c1">#!/usr/bin/env ruby</span>
<span class="c1"># encoding: utf-8</span>

<span class="nb">require</span> <span class="s2">"bunny"</span>

<span class="n">conn</span> <span class="o">=</span> <span class="no">Bunny</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:automatically_recover</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>
<span class="n">conn</span><span class="p">.</span><span class="nf">start</span>

<span class="n">ch</span>   <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">create_channel</span>

<span class="n">q</span>    <span class="o">=</span> <span class="n">ch</span><span class="p">.</span><span class="nf">queue</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>
<span class="n">ch</span><span class="p">.</span><span class="nf">default_exchange</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="s2">"Hello World!"</span><span class="p">,</span> <span class="ss">:routing_key</span> <span class="o">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="nf">name</span><span class="p">)</span>
<span class="nb">puts</span> <span class="s2">" [x] Sent 'Hello World!'"</span>

<span class="n">conn</span><span class="p">.</span><span class="nf">close</span>
</pre>

<p><strong>Mesajın alınması</strong></p>

<ul>
<li>RabbitMQ&#39;a bağlanmak, yeni bir kanal açmak ve kuyruğu tanımlamak için</li>
</ul>
<pre class="highlight ruby"><span class="c1">#!/usr/bin/env ruby</span>
<span class="c1"># encoding: utf-8</span>

<span class="nb">require</span> <span class="s2">"bunny"</span>

<span class="n">conn</span> <span class="o">=</span> <span class="no">Bunny</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:automatically_recover</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>
<span class="n">conn</span><span class="p">.</span><span class="nf">start</span>

<span class="n">ch</span>   <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">create_channel</span>
<span class="n">q</span>    <span class="o">=</span> <span class="n">ch</span><span class="p">.</span><span class="nf">queue</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>
</pre>

<ul>
<li>Mesajları dinlemek için <code>Bunny::Queue#subscribe</code> methodu kullanılır.</li>
</ul>
<pre class="highlight ruby"><span class="k">begin</span>
  <span class="nb">puts</span> <span class="s2">" [*] Waiting for messages. To exit press CTRL+C"</span>
  <span class="n">q</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="ss">:block</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">delivery_info</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">body</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">" [x] Received </span><span class="si">#{</span><span class="n">body</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">rescue</span> <span class="no">Interrupt</span> <span class="o">=&gt;</span> <span class="n">_</span>
  <span class="n">conn</span><span class="p">.</span><span class="nf">close</span>
  <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">end</span>
</pre>

<ul>
<li>Hepsini birleştirip <code>receiver.rb</code> dosyasını oluşturalım.</li>
</ul>
<pre class="highlight ruby"><span class="c1">#!/usr/bin/env ruby</span>
<span class="c1"># encoding: utf-8</span>

<span class="nb">require</span> <span class="s2">"bunny"</span>

<span class="n">conn</span> <span class="o">=</span> <span class="no">Bunny</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:automatically_recover</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>
<span class="n">conn</span><span class="p">.</span><span class="nf">start</span>

<span class="n">ch</span>   <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">create_channel</span>
<span class="n">q</span>    <span class="o">=</span> <span class="n">ch</span><span class="p">.</span><span class="nf">queue</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>

<span class="k">begin</span>
  <span class="nb">puts</span> <span class="s2">" [*] Waiting for messages. To exit press CTRL+C"</span>
  <span class="n">q</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="ss">:block</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">delivery_info</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">body</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">" [x] Received </span><span class="si">#{</span><span class="n">body</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">rescue</span> <span class="no">Interrupt</span> <span class="o">=&gt;</span> <span class="n">_</span>
  <span class="n">conn</span><span class="p">.</span><span class="nf">close</span>
  <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">end</span>
</pre>

<p><strong>Terminalden dosyaları çalıştıralım.</strong></p>

<p>Unutmayın ayrı ayrı sekmelerde çalıştıracaksınız!</p>
<pre class="highlight shell"><span class="gp">$ </span>ruby -rubygems send.rb
<span class="gp">$ </span>ruby -rubygems receive.rb
</pre>

<p>Sonuçları terminal çıktılarından görebileceğiniz gibi <code>http://localhost:15672/</code> adresinden veya terminalden <code>rabbitmqctl list_queues</code> kodu ile de görebilirsiniz.</p>

<p>Bundan sonraki makalemiz RabbitMQ ve iş kuyrukları üzerine olacaktır.</p>

<p>Saygılar.</p>

<h3>Kaynaklar</h3>

<ul>
<li><a href="https://www.rabbitmq.com/tutorials/tutorial-one-ruby.html">https://www.rabbitmq.com/tutorials/tutorial-one-ruby.html</a></li>
</ul>

<div id='disqus_thread'></div>
<script>
  var disqus_shortname = 'lab2023';
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>
Please enable JavaScript to view the
<a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a>
</noscript>
<a class='dsq-brlink' href='http://disqus.com'>
comments powered by
<span class='logo-disqus'>Disqus</span>
</a>
</article>
</div>
</div>
</div>
<footer class='footer'>
<h4>© 2014 LAB2023, CORP.</h4>
<p>The all designs, materials and contents trademarks of lab2023, corp.</p>
</footer>

</body>
<!-- Javascripts -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.7.1/modernizr.min.js" type="text/javascript"></script>
<script src="assets/javascripts/application.js" type="text/javascript"></script>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12243799-3']);
  _gaq.push(['_trackPageview']);
  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


</html>
